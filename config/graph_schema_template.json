{
  "meta": {
    "version": "2.0",
    "description": "Strikt schema för MyMemory med stöd för Self-Healing Graph (Provisional/Verified).",
    "strict_mode": true
  },
  "base_properties": {
    "description": "Egenskaper som alla noder automatiskt får (system-nivå).",
    "properties": {
      "id": { "type": "string", "required": true, "description": "Primary Key (UUID för dok, Email för person, etc)" },
      "created_at": { "type": "timestamp", "required": true },
      "last_synced_at": { "type": "timestamp", "required": true },
      "source_system": { "type": "string", "required": false },
      "status": {
        "type": "enum",
        "required": true,
        "values": ["VERIFIED", "PROVISIONAL"],
        "default": "PROVISIONAL",
        "description": "Anger om entiteten är bekräftad sanning eller en gissning."
      },
      "distinguishing_context": {
        "type": "list",
        "required": false,
        "description": "Lista med nyckelord/kontext för att skilja dubbletter åt (t.ex. ['IT', 'Chef'])."
      }
    }
  },
  "nodes": {
    "Person": {
      "description": "En unik fysisk individ.",
      "primary_key_strategy": "NATURAL_KEY",
      "lookup_key": "name",
      "allowed_sources": ["Slack", "Mail", "Calendar", "AD", "Manual"],
      "creation_policy": "STRICT_LOOKUP",
      "properties": {
        "email": { 
          "required": false, 
          "type": "string", 
          "regex": "^[\\w.]+@([\\w-]+\\.)+[\\w-]{2,4}$",
          "description": "Unik identifierare (används som ID)"
        },
        "name": { "required": true, "type": "string" },
        "type": { 
          "required": true, 
          "type": "enum", 
          "values": ["INTERNAL", "OTHER"],
          "description": "INTERNAL om domän matchar ägarens organisation"
        },
        "phone": { "required": false, "type": "string" },
        "linked_in": { "required": false, "type": "string" },
        "slack_alias": { "required": false, "type": "string" }
      }
    },
    "Organization": {
      "description": "Den organisatoriska entiteten (Bolag, Myndighet, etc).",
      "primary_key_strategy": "NATURAL_KEY",
      "lookup_key": "org_number",
      "fallback_key": "name",
      "allowed_sources": ["CRM", "ERP", "Manual", "System"],
      "creation_policy": "STRICT_LOOKUP",
      "properties": {
        "name": { "required": true, "type": "string" },
        "type": { 
          "required": true, 
          "type": "enum", 
          "values": ["Bolag", "Förening", "Nation", "Myndighet", "Kommun"] 
        },
        "org_number": { "required": false, "type": "string", "description": "Föredraget ID" },
        "domain": { "required": false, "type": "string" },
        "source_id": { "required": false, "type": "string" },
        "urls": { "required": false, "type": "list" }
      }
    },
    "Group": {
      "description": "Organisatoriska enheter (Team, Avdelningar).",
      "primary_key_strategy": "COMPOSITE_KEY",
      "lookup_key": "name",
      "allowed_sources": ["AD", "Slack", "Manual"],
      "creation_policy": "STRICT_LOOKUP",
      "properties": {
        "name": { "required": true, "type": "string" },
        "type": { 
          "required": true, 
          "type": "enum", 
          "values": ["Team", "Affärsenhet", "Avdelning", "Enhet", "Arbetsgrupp", "Styrgrupp", "Ledningsgrupp"] 
        },
        "slack_channel": { "required": false, "type": "string" },
        "source_id": { "required": false, "type": "string" }
      }
    },
    "Project": {
      "description": "Ett initiativ med start, slut och mål.",
      "primary_key_strategy": "NATURAL_KEY",
      "lookup_key": "source_id",
      "fallback_key": "name",
      "allowed_sources": ["Harvest", "Jira", "Manual", "System"],
      "creation_policy": "STRICT_LOOKUP",
      "properties": {
        "name": { "required": true, "type": "string" },
        "source_id": { "required": false, "type": "string", "description": "Harvest ID, Jira Key" },
        "status": { "required": false, "type": "enum", "values": ["ACTIVE", "ARCHIVED"] },
        "type": { "required": false, "type": "enum", "values": ["INTERNAL", "EXTERNAL"] },
        "start_date": { "required": false, "type": "date" },
        "end_date": { "required": false, "type": "date" },
        "budget_value": { "required": false, "type": "string" },
        "budget_hours": { "required": false, "type": "number" }
      }
    },
    "Event": {
      "description": "Tidsbestämd aktivitet (Möte, Workshop).",
      "primary_key_strategy": "SOURCE_ID",
      "lookup_key": "source_id",
      "allowed_sources": ["GoogleCalendar"],
      "creation_policy": "ALWAYS_CREATE",
      "properties": {
        "subject": { "required": true, "type": "string", "default": "No Title" },
        "source_id": { "required": true, "type": "string", "description": "Google Event ID" },
        "start_time": { "required": true, "type": "timestamp" },
        "end_time": { "required": false, "type": "timestamp" },
        "internal": { "required": false, "type": "boolean" },
        "type": { "required": false, "type": "string" },
        "location": { "required": false, "type": "string" }
      }
    },
    "Business_relation": {
      "description": "Klassificering av relation (Leverantör, Kund).",
      "primary_key_strategy": "NATURAL_KEY",
      "lookup_key": "name",
      "allowed_sources": ["System"],
      "creation_policy": "STRICT_LOOKUP",
      "properties": {
        "name": { 
          "required": true, 
          "type": "enum", 
          "values": ["SUPPLIER", "CLIENT", "PARTNER", "SALES_PROSPECT", "SALES_LEAD"] 
        }
      }
    },
    "Roles": {
      "description": "Funktionell kompetens eller titel.",
      "primary_key_strategy": "NATURAL_KEY",
      "lookup_key": "name",
      "allowed_sources": ["System", "AD"],
      "creation_policy": "STRICT_LOOKUP",
      "properties": {
        "name": { "required": true, "type": "string" },
        "category": { "required": false, "type": "enum", "values": ["Funktionell", "Formell"] },
        "skill_level": { "required": false, "type": "string" }
      }
    },
    "Document": {
      "description": "Ett ostrukturerat objekt som bär information.",
      "primary_key_strategy": "UUID",
      "lookup_key": "uuid",
      "allowed_sources": ["FileRetriever", "DocConverter", "Transcriber"],
      "creation_policy": "ALWAYS_CREATE",
      "properties": {
        "uuid": { "required": true, "type": "uuid", "description": "Filens UUID från Assets" },
        "title": { "required": true, "type": "string" },
        "doc_format": { 
          "required": false, 
          "type": "enum", 
          "values": [".pdf", ".docx", ".txt", ".md", ".json", ".xls", ".xlsx", ".csv"] 
        },
        "type": { 
          "required": false, 
          "type": "enum", 
          "values": ["AVTAL", "BESLUT", "SPECIFIKATION", "LEVERANSDOKUMENT", "OFFERT", "UPPDRAGSBESKRIVNING", "PROTOKOLL"] 
        },
        "created_at": { "required": false, "type": "timestamp" },
        "version": { "required": false, "type": "string" }
      }
    }
  },
  "edges": {
    "MENTIONS": {
      "source_type": ["Document"],
      "target_type": ["Person", "Organization", "Group", "Project", "Event"],
      "description": "Dokumentet nämner en entitet.",
      "validation_rule": "TARGET_MUST_EXIST",
      "properties": {
        "confidence_score": { "required": true, "type": "float", "min": 0.0, "max": 1.0 },
        "snippet": { "required": false, "type": "string" }
      }
    },
    "ATTENDED": {
      "source_type": ["Person"],
      "target_type": ["Event"],
      "validation_rule": "TARGET_MUST_EXIST",
      "properties": {
        "response_status": { 
          "required": true, 
          "type": "enum", 
          "values": ["ACCEPTED", "TENTATIVE", "ORGANIZER", "NO_ANSWER"] 
        },
        "duration_minutes": { "required": false, "type": "integer" }
      }
    },
    "BELONGS_TO": {
      "source_type": ["Person", "Group"],
      "target_type": ["Organization", "Group"],
      "validation_rule": "TARGET_MUST_EXIST",
      "properties": {
        "start_date": { "required": false, "type": "date" },
        "end_date": { "required": false, "type": "date" },
        "job_title": { "required": false, "type": "string" },
        "job_function": { "required": false, "type": "string" }
      }
    },
    "HAS_BUSINESS_RELATION": {
      "source_type": ["Organization"],
      "target_type": ["Business_relation"],
      "validation_rule": "TARGET_MUST_EXIST",
      "properties": {
        "status": { "required": true, "type": "enum", "values": ["Active", "Inactive"] },
        "contract_id": { "required": false, "type": "string" }
      }
    },
    "HAS_ROLE": {
      "source_type": ["Person"],
      "target_type": ["Roles"],
      "validation_rule": "TARGET_MUST_EXIST",
      "properties": {
        "context": { "required": false, "type": "string" }
      }
    }
  }
}