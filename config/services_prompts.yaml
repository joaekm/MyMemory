# DFM Prompt-bibliotek (services_prompts.yaml)

# --- Transformations-agenten (Ljud/Video) ---
transcriber:
  analysis_prompt: |
    {context_injection}

    Du får en rå transkription från en ljudfil. Utför följande tre steg:
    
    STEG 1: KVALITETSKONTROLL
    Bedöm om transkriberingen är ANVÄNDBAR.
    Returnera quality_status "FAILED" om NÅGOT av följande stämmer:
    - Mindre än 50 meningsfulla ord (exkludera talarmarkeringar)
    - Bara talarmarkeringar utan faktiskt innehåll ("Talare 1: Talare 2: Talare 3:")
    - Samma ord eller fras upprepas mer än 10 gånger i rad
    - Innehållet är oförståeligt, korrupt eller nonsens
    - Bara tystnad, ljud-markeringar eller bakgrundsljud
    Om FAILED: Ange failure_reason och hoppa över steg 2-3.
    
    STEG 2: KORRIGERAD TRANSKRIPTION (endast om quality_status är "OK")
    - Identifiera talarna från innehållet (de presenterar sig ofta i början).
    - VIKTIGT: Om "MÖTESKONTEXT" angavs ovan, använd deltagarlistan därifrån för att avgöra vilka talarna är.
    - Skriv ut HELA transkriptionen med riktiga namn där det är möjligt.
    - Format: "Namn: text" (Talarnamn, kolon, mellanslag).
    - Om ett namn är okänt, behåll "Talare N".
    - Standardisera formatet (ta bort hakparenteser, fixa radbrytningar).
    - Behåll allt innehåll - korta inte ner.
    
    STEG 3: METADATA
    Extrahera strukturerad information från innehållet.
    Använd MÖTESKONTEXT för att fylla i syfte och entiteter om det är otydligt i ljudet.
    
    RETURNERA EXAKT DENNA JSON-STRUKTUR:
    {
      "quality_status": "OK" eller "FAILED",
      "failure_reason": "Endast vid FAILED - kortfattad förklaring",
      "transcript": "Den korrigerade transkriptionen med riktiga namn och enhetligt format",
      "speakers": ["Lista med identifierade talare"],
      "summary": "Sammanfattning på svenska av vad som diskuteras",
      "keywords": ["Relevanta sökord"],
      "entities": ["Personer", "Organisationer", "Projekt som nämns"]
    }

# --- Doc Converter (Textfiler/Dokument) - OPTIMERAD ---
doc_converter:
  generate_metadata: |
    Sammanfatta följande text på svenska.
    Fokusera på det viktigaste innehållet, beslut och entiteter.
    Generera även 5-10 relevanta nyckelord (tags).

    Text:
    {text_chunk}

    JSON Output:
    {{
      "summary": "...",
      "keywords": ["tag1", "tag2"]
    }}

  doc_summary_prompt: |
    Sammanfatta detta dokument kortfattat och informativt på svenska.
    Fokusera på VAD det är, VEM det berör och VILKA beslut/händelser som nämns.

    TEXT:
    {text}

    RETURNERA JSON:
    {{
      "summary": "Din sammanfattning här...",
      "keywords": ["nyckelord1", "nyckelord2"]
    }}

  strict_entity_extraction: |
    Du är en strikt data-extraktor. Din enda uppgift är att identifiera potentiella entiteter och datum i texten.
    
    TEXT ATT ANALYSERA:
    {text_chunk}
    
    INSTRUKTIONER:
    1. Identifiera EGENNAMN (Proper Nouns) inom följande kategorier:
       - "Person": För- och efternamn (t.ex. "Joakim Ekman", "Cenk"). Inkludera även tydliga alias/smeknamn om de används som namn.
       - "Organization": Företag, Myndigheter, Föreningar (t.ex. "Digitalist", "Adda", "Skatteverket").
       - "Project": Namngivna uppdrag, system eller initiativ (t.ex. "MyMemory", "Adda PoC", "Hjälplinjen").
       
    2. Identifiera DATUM:
       - Extrahera explicita datum.
       - Konvertera till ISO 8601 (YYYY-MM-DD) där det är entydigt.
    
    3. REGLER FÖR EXTRAKTION:
       - Var "bokstavlig". Gissa inte. Står det "Jocke", extrahera "Jocke". 
       - Normalisera INTE namnen mot extern kunskap (det gör systemet senare).
       - Gör INGA bedömningar om relevans. Är det ett egennamn i texten? Ta med det.
       - Hitta INTE på egna kategorier. Använd endast: "Person", "Organization", "Project".
    
    RETURNERA ENDAST JSON:
    {{
      "candidates": [
        {{ "text": "Det exakta namnet i texten", "type": "Person|Organization|Project", "context": "Kort citat där namnet nämns" }},
        ...
      ],
      "dates": ["YYYY-MM-DD", ...]
    }}
