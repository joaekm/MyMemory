# DFM Prompt-bibliotek (services_prompts.yaml)

# --- Transformations-agenten (Ljud/Video) ---
transcriber:
  analysis_prompt: |
    Du får en rå transkription från en ljudfil. Utför följande tre steg:
    
    STEG 1: KVALITETSKONTROLL
    Bedöm om transkriberingen är ANVÄNDBAR.
    Returnera quality_status "FAILED" om NÅGOT av följande stämmer:
    - Mindre än 50 meningsfulla ord (exkludera talarmarkeringar)
    - Bara talarmarkeringar utan faktiskt innehåll ("Talare 1: Talare 2: Talare 3:")
    - Samma ord eller fras upprepas mer än 10 gånger i rad
    - Innehållet är oförståeligt, korrupt eller nonsens
    - Bara tystnad, ljud-markeringar eller bakgrundsljud
    Om FAILED: Ange failure_reason och hoppa över steg 2-3.
    
    STEG 2: KORRIGERAD TRANSKRIPTION (endast om quality_status är "OK")
    - Identifiera talarna från innehållet (de presenterar sig ofta i början)
    - Skriv ut HELA transkriptionen med riktiga namn där det är möjligt
    - Format: "Namn: text" (kolon, mellanslag, en rad per replik)
    - Om ett namn är okänt, behåll "Talare N"
    - Standardisera formatet (ta bort hakparenteser, fixa radbrytningar)
    - Behåll allt innehåll - korta inte ner
    
    STEG 3: METADATA
    Extrahera strukturerad information från innehållet.
    
    RETURNERA EXAKT DENNA JSON-STRUKTUR:
    {
      "quality_status": "OK" eller "FAILED",
      "failure_reason": "Endast vid FAILED - kortfattad förklaring",
      "transcript": "Den korrigerade transkriptionen med riktiga namn och enhetligt format",
      "speakers": ["Lista med identifierade talare"],
      "summary": "Sammanfattning på svenska av vad som diskuteras",
      "keywords": ["Relevanta sökord"],
      "entities": ["Personer", "Organisationer", "Projekt som nämns"]
    }

# --- Doc Converter (Textfiler/Dokument) ---
doc_converter:
  # Denna prompt används för att injicera OTS-taxonomin
  ots_injection_prompt: |
    Din uppgift är att strukturera ostrukturerad text enligt en strikt taxonomi.

    GILTIGA MASTER NODER:
    {valid_nodes}

    DEFINITIONER AV NODER:
    - Vision: Framtidsbilder, syfte, långsiktiga mål (2-5 år), "Varför vi finns".
    - Strategi: Vägval, roadmaps, affärsplaner, målarkitektur, styrkor/utmaningar.
    - Förändring: Transformation, digitalisering, organisationsförändring, kulturresor.
    - Marknad: Positionering, konkurrenter, omvärldsanalys, leads, varumärke.
    - Affär: Affärsmodeller, lönsamhet, kalkyl, prissättning, säljaktiviteter.
    - Kultur: Värderingar, "The Digitalist Way", psykologisk trygghet, samarbetsklimat.
    - Projekt: Konkreta uppdrag, PoC (t.ex. Vulkan), backlogs, projektledning.
    - Metodik: Hur vi arbetar. Agile, Service Design, WoW, HIIT, principer.
    - Erbjudande: Våra produkter och tjänster (MyMem, P-Bot, Konsulting).
    - Avtal: Offerter, ramavtal, licenser, upphandlingar (FKU).
    - Organisation: Rekrytering, team, roller, onboarding, personalfrågor.
    - Händelser: Möten, workshops, konferenser, daglig status, incidenter.
    - Administration: Tidrapportering, sjukanmälan, resursplanering, loggar.
    - Arbetsverktyg: Mjukvara vi använder (Slack, Jira, Fortnox), hårdvara.
    - Teknologier: Kodspråk (Python), ramverk, AI-modeller, databaser, "Tech".
    - Aktör: Externa organisationer, kunder, partners, myndigheter.
    - Person: Specifika individer, medarbetare, kontaktpersoner.
    - Plats: Kontor, orter, fysiska/digitala rum.
    - Process: Arbetsflöden, leveransprocesser, datahantering, "Operating".
    - Juridik: Lagkrav, GDPR, compliance, affärsjuridik.
    - Kvalitet: Prestanda, tester, tillgänglighet, spårbarhet.
    - Säkerhet: Informationssäkerhet, lösenordshantering, sårbarheter.
    - Standard: ISO-certifieringar, WCAG, öppna standarder.
    - Arkitektur: Systemdesign, MACH, lösningar, integrationer.
    - Data: Testdata, entiteter, metadata-strukturer.
    - Resultat: Utfall, succéer, måluppfyllnad.

    INSTRUKTION:
    Analysera texten och placera den i exakt EN av ovanstående kategorier.

    VIKTIG INSTRUKTION FÖR ENTITETER:
    Om texten nämner en person eller ett projekt som finns i listan KÄNDA PERSONER/PROJEKT,
    använd EXAKT det namnet. Gissa INTE egna varianter.
    
    ENTITETSNAMN REGLER:
    - IGNORERA filnamn som entiteter (*.py, *.js, *.md, *.txt etc) - de är INTE projekt
    - KORTA namn till max 40 tecken. "Abelsson eller annan funktionell..." → "Abelsson"
    - Om ett namn har förkortning i parentes, t.ex. "Carbon Copy Machine (CCM)", 
      använd BARA huvudnamnet "Carbon Copy Machine" och lägg förkortningen som alias
    - Entiteter ska vara NAMN på personer/organisationer/projekt, inte beskrivningar
    
    ALIAS-DETEKTION:
    Om texten innehåller namnvarianter som troligen refererar till samma entitet,
    rapportera dessa som "potential_aliases". Exempel:
    - "Sänk" nämns i samma kontext som "Cenk" → potential alias
    - "Adda-grejen" och "Adda PoC" → potential alias
    - Smeknamn, förkortningar, felstavningar
    - "CCM" och "Carbon Copy Machine" → potential alias
    
    OUTPUT KRAV (Returnera ENDAST denna JSON):
    {
      "summary": "Kort sammanfattning på svenska. INKLUDERA viktiga datum och aktiviteter.",
      "graph_nodes": {
        "Händelser": 0.7,
        "Teknologier": 0.3,
        "Person": {
          "Tommy Olsson": 0.6
        },
        "Aktör": {
          "Adda": 0.8
        },
        "Projekt": {
          "Adda PoC": 0.9
        }
      },
      "dates_mentioned": ["YYYY-MM-DD format för alla datum nämnda i texten"],
      "actions": ["Aktiviteter som nämns (t.ex. 'Användartester', 'Demo', 'Möte')"],
      "deadlines": [
        {"what": "Vad som ska ske", "when": "YYYY-MM-DD"}
      ],
      "potential_aliases": [
        {"name_variant": "Smeknamn/variant", "likely_refers_to": "Formellt namn", "entity_type": "Person|Aktör|Projekt", "confidence": "low|medium|high"}
      ]
    }
    
    GRAPH_NODES INSTRUKTION:
    - Abstrakta koncept (masternoder som Händelser, Teknologier): Ange relevans 0.0-1.0
    - Typade entiteter (Person, Aktör, Projekt): Dict med namn → relevans
    - CUTOFF: Inkludera ENDAST noder med relevans >= 0.2
    - Dokumentet kan vara relevant för FLERA masternoder (viktat)
    - Använd EXAKT namn från KÄNDA PERSONER/PROJEKT om tillgängliga

# --- Chatt-agenten (RAG-gränssnitt) ---
chat:
  system_prompt: |
    Du är "MyMemory", en intelligent assistent. Svara baserat på bifogad kontext.

# --- Dreamer (Taxonomi-konsolidering) ---
dreamer:
  consolidation_prompt: |
    Du är en taxonomi-expert. Din uppgift är att kategorisera NYA noder under rätt masternode.
    
    BEFINTLIGA MASTERNODER (med beskrivningar):
    {master_nodes}
    
    NYA KONCEPT (okategoriserade):
    {new_concepts}
    
    NYA ENTITETER (per typ):
    {new_entities}
    
    INSTRUKTIONER:
    1. Placera varje nytt koncept under den MEST passande masternoden
    2. Använd EXAKT nodnamn från BEFINTLIGA MASTERNODER ovan som nycklar
    3. Om ett koncept är ett ALIAS för något som redan finns, lägg det i aliases_detected
    4. Var konsekvent - liknande koncept ska hamna under samma masternode
    5. VARJE koncept MÅSTE placeras under en masternode - ingen får utelämnas
    
    RETURNERA ENDAST GILTIG JSON. Exempel på korrekt format:
    {"Händelser": ["Sprint review", "Standup"], "Teknologier": ["Kubernetes"], "Person": ["Anna"], "aliases_detected": [{"alias": "K8s", "canonical": "Kubernetes", "confidence": "high"}]}
    
    Nycklar MÅSTE vara exakta nodnamn från BEFINTLIGA MASTERNODER. Inkludera INTE noder utan nya koncept.